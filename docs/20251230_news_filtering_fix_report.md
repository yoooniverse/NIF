# 뉴스 카테고리 필터링 오류 해결 리포트 (2025-12-30)

## 1. 문제 현상 (Issue)
- **증상**: 주요 뉴스 기사가 '부동산', '주식', '가상화폐' 등 여러 카테고리에 해당함에도 불구하고, 서비스 화면에서는 **'부동산' 탭에서만 뉴스가 노출**되고 나머지 탭(주식, 가상화폐, ETF, 환율)에서는 "뉴스가 없습니다"라고 표시됨.
- **원인**: 
    1. 데이터베이스에는 여러 관심사가 등록되어 있으나, API가 프론트엔드로 데이터를 넘겨줄 때 대표 카테고리 1개만 전달함.
    2. 프론트엔드 필터링 로직이 단일 카테고리 값만 체크하여, 다중 태깅된 뉴스를 인식하지 못함.
    3. UI 뱃지가 사용자가 선택한 탭과 상관없이 데이터의 첫 번째 태그(부동산)로 고정되어 나타남.

## 2. 해결 방법 (Technical Solution)

### A. 데이터 구조 개선 (`types/news.ts`, `lib/news.ts`)
- 뉴스 목록 아이템(`NewsListItem`) 타입에 `tags: string[]` 배열을 추가하여, 하나의 뉴스가 가진 모든 관심사 정보를 프론트엔드에 전달할 수 있도록 수정했습니다.
- 뉴스 변환 함수(`convertNewsListItemToNews`)가 API의 `tags` 리스트를 우선적으로 사용하도록 로직을 보완했습니다.

### B. API 필터링 및 카테고리 선정 로직 최적화 (`app/api/news/route.ts`, `monthly/route.ts`)
- **지능형 카테고리 선정**: 뉴스가 여러 태그를 가졌을 때, 사용자가 현재 클릭한 탭(카테고리)이 태그에 포함되어 있다면 해당 카테고리를 '대표 뱃지'로 우선 설정합니다. 
    - *예: '부동산'과 '주식'이 모두 달린 뉴스를 '주식' 탭에서 볼 때는 뱃지가 '주식'으로 표시됨.*
- **보안 강화**: '직장인', '대출보유'와 같은 시스템 내부용 상황 정보(Context)가 UI 태그에 노출되지 않도록, 허용된 관심사 리스트(Allowlist)만 필터링하여 전달하도록 수정했습니다.

### C. 프론트엔드 필터링 정교화 (`lib/news.ts`)
- `filterNewsByCategory` 함수가 뉴스에 달린 모든 태그 리스트를 뒤져서 사용자가 선택한 카테고리가 포함되어 있는지 검사하도록 변경했습니다.

## 3. 결과 (Result)
- 이제 **주식, 가상화폐, ETF, 환율 등 모든 카테고리 탭**에서 해당 뉴스가 정상적으로 노출됩니다.
- 뉴스가 여러 카테고리에 속할 경우, 현재 사용자가 보고 있는 탭에 맞춰 카드 상단의 카테고리 이름이 유동적으로 변경되어 사용자 혼란을 방지합니다.

---
**Antigravity AI Assistant** | 2025-12-30 수정 완료.
